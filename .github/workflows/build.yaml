name: Build

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the master branch
on:
  push:
    branches: [ build ]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    strategy:
      matrix:
        docker: ['ubi','scratch']
    # The type of runner that the job will run on
    runs-on: ubuntu-latest
    name: ${{ matrix.docker }}
    steps:
    - name: build
      uses: sysdiglabs/exporter-builder@v0.6
      with:
        exporter: promcat-jmx-exporter
        artifactory_token: ${{ secrets.ARTI_TOKEN }}
        artifactory_username: david.lorite@sysdig.com
        sysdig_secure_token: ${{ secrets.SYSDIG_SECURE_TOKEN }}
        tag_name: dev
        target: ${{ matrix.docker }}
        repository: artifactory.internal.sysdig.com
        dockerfile: "./build/Dockerfile"
