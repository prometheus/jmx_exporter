---
lowercaseOutputLabelNames: true
lowercaseOutputName: true
blackListObjectNames:
- "metrics:type=*,name=jvm*"
- "metrics:type=*,name=ch.qos.logback.core.Appender.all"

rules:

- pattern: "metrics<name=ch.qos.logback.core.Appender.(debug|error|info|trace|warn)><>Count"
  name: logback_msg_total
  labels:
    level: "$1"
  type: COUNTER


- pattern: "metrics<name=org.eclipse.jetty.server.HttpConnectionFactory.(.+).connections><>Count"
  name: http_connections_total
  type: COUNTER
  labels:
    port: "$1"

- pattern: "metrics<name=io.dropwizard.jetty.MutableServletContextHandler.(.+)-responses><>Count"
  name: http_response_codes_total
  type: COUNTER
  labels:
    http_code: "$1"

- pattern: "metrics<name=io.dropwizard.jetty.MutableServletContextHandler.active-(.+)><>Count"
  name: http_active_$1
  type: GAUGE

- pattern: "metrics<name=io.dropwizard.jetty.MutableServletContextHandler.async-(.+)><>Count"
  name: http_request_async_$1_total
  type: COUNTER


- pattern: "metrics<name=io.dropwizard.jetty.MutableServletContextHandler.(.+)-requests><>Count"
  name: http_request_total
  type: COUNTER
  labels:
    http_method: "$1"


- pattern: "metrics<name=io.dropwizard.jetty.MutableServletContextHandler.requests><>Count"
  name: http_all_request_total
  type: COUNTER

- pattern: "^metrics<name=org.eclipse.jetty.util.thread.QueuedThreadPool.dw.(.+)><>Value"
  name: dw_jetty_queued_thread_pool
  type: GAUGE
  labels:
    threadpool: "$1"

# Catch-all metrics below

- pattern: "^metrics<name=(.+)><>Count"
  name: dw_$1
  type: COUNTER

- pattern: "^metrics<name=(.+)><>Value"
  name: dw_$1
  type: GAUGE

# This to show how percentiles might be formatted. Note that it is not meaningful to sum/average or do other calculations on these values
# This pattern will also collide with the other catch-all value just above so the name=(.+) should be tailored to the metric you are matching
#- pattern: metrics<name=(.+)><>(Max|MinMean|StdDev|50thPercentile|75thPercentile|95thPercentile|98thPercentile|99thPercentile|999thPercentile)
#  name: dw_$1
#  type: GAUGE
#  labels:
#    calculation: "$2"


